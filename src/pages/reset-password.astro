---
import Layout from "@/layouts/Layout.astro";
import { ResetPasswordForm } from "@/components/auth/ResetPasswordForm";

// Server-side logic: Verify reset token in URL
// Supabase automatically exchanges the token for a session via the URL hash
// The middleware will handle session validation

// Get query parameters for messages/errors
const message = Astro.url.searchParams.get("message");
const error = Astro.url.searchParams.get("error");

// Check for error_code and error_description from Supabase
const errorCode = Astro.url.searchParams.get("error_code");
const errorDescription = Astro.url.searchParams.get("error_description");

// Map Supabase errors to user-friendly messages
let errorMessage = error;
if (errorCode) {
  if (errorCode === "401") {
    errorMessage = "Link resetujący hasło jest nieprawidłowy lub wygasł";
  } else if (errorDescription) {
    errorMessage = errorDescription;
  }
}
---

<Layout title="Resetuj hasło" showNavigation={false}>
  <ResetPasswordForm client:load message={message} error={errorMessage} />
</Layout>
